<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="comma.sist.tourist.dao.tourist-mapper">

   <!-- 1.초기_tourist 목록(5개 뽑아내기)-->
   <select id="touristFiveData" resultType="Tourist" parameterType="java.util.Map">
      SELECT tour_no,user_id,text_no,tour_theme,tour_detail,num               
      FROM (SELECT tour_no,user_id,text_no,tour_theme,tour_detail,rownum as num
            FROM (SELECT tour_no,user_id,text_no,tour_theme,tour_detail
                  FROM tour ORDER BY tour_no DESC))
      WHERE num BETWEEN #{start} AND #{end}      
   </select>
   
   <!-- 1.초기_user에서 데이터가져오기 -->
   <select id="touristUserData" resultType="User" parameterType="String">
      SELECT user_nick,user_img,user_sex,user_birth         
      FROM users
      WHERE user_id=#{tid}
   </select>
   
   <!-- 1.초기_text에서 데이터 가져오기 -->
    <select id="touristTextData" resultType="Text" parameterType="int">
      SELECT text_loc,text_cost,text_total_person,text_time1,text_time2,text_tour_date,text_move   
      FROM text
      WHERE text_no=#{tno}
   </select>
   
   
   
   
   
   <!-- 2.검색_날짜&지역 -->
     <select id="touristSearchData" resultType="Tourist" parameterType="java.util.Map">
      SELECT tour_no,user_id,text_no,tour_theme,tour_detail,num               
      FROM (SELECT tour_no,user_id,text_no,tour_theme,tour_detail,rownum as num
            FROM (SELECT tour_no,user_id,tour.text_no,tour_theme,tour_detail
                  FROM tour,text 
                  WHERE text_loc=#{place} AND text_tour_date=#{date} AND tour.text_no=text.text_no
                  ORDER BY tour_no DESC))
      WHERE num BETWEEN #{start} AND #{end}      
   </select>
   
   <!-- 2. 검색_tourist게시판 글 수  -->
   <select id="tourRowCountSearch" resultType="int" parameterType="java.util.Map">   
      SELECT COUNT(*) 
      FROM tour,text 
      WHERE text_loc=#{place} AND text_tour_date=#{date} AND tour.text_no=text.text_no
   </select>
   
   <!-- 1. tourist게시판 글 수  -->
   <select id="tourRowCount" resultType="int">   
      SELECT COUNT(*) FROM tour
   </select>
   
   
   
   <!-- 2.정렬하기(가격높은순,등록일자순,가이드평점순) -->
   <select id="touristSortType" resultType="Tourist" parameterType="java.util.Map">
      SELECT tour_no,user_id,text_no,tour_theme,tour_detail,num               
      FROM (SELECT tour_no,user_id,text_no,tour_theme,tour_detail,text_cost,rownum as num
            FROM (SELECT tour_no,user_id,tour.text_no,tour_theme,tour_detail,text_cost
                  FROM tour,text 
                  WHERE text_loc=#{place} AND text_tour_date=${date} AND tour.text_no=text.text_no
                  ORDER BY #{sort} DESC)) 
      WHERE num BETWEEN #{start} AND #{end}   
   </select> 
  
   
  <!--
   <insert id="touristInsert" parameterMap="TourList">
      insert into tour(tour_no,user_id,text_no,tour_theme,tour_detail)
      values((select NVL(max(tour_no)+1,1) from tour),
      #{user_id},(select max(text_no) as text_no from text),#{tour_theme},#{tour_detail})
   </insert>   -->
   
   
   

   <!-- tourist게시판 글쓰기 --> 
   <insert id="textInsert1" parameterMap="comma.sist.common.text-mapper.TextList_param">
      insert into text values((select NVL(max(text_no)+1,1) from text),#{text_loc},#{text_cost},#{text_total_person},sysdate,
      #{text_time1},#{text_time2},#{text_move},0,'n',#{text_tour_date})
   </insert>
 
   <insert id="touristInsert" parameterMap="comma.sist.common.text-mapper.TextList_param">
      <selectKey keyProperty="text_no" resultType="int" order="BEFORE">
            select max(text_no) as text_no from text
      </selectKey>
           insert into tour(tour_no,user_id,text_no,tour_theme,tour_detail)
           values((select NVL(max(tour_no)+1,1) from tour),
           #{touristvo.user_id},#{text_no},#{touristvo.tour_theme},#{touristvo.tour_detail})
   </insert>
  

    
</mapper>